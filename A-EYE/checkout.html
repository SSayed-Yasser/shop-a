<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <style>
        .product {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            margin: 10px;
            display: flex;
            align-items: center;
        }
        .product img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
        }
        .product-details {
            flex: 1;
            margin-left: 10px;
        }
        .delivery-options, .order-summary, .checkout-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .order-summary {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>Cart: <span id="cart-count">0 items</span></h1>
    <div id="checkout-products"></div>
    <div class="order-summary">
        <p id="total-price">Total Price: 0 EG</p>
        <p id="tax">Tax (14%): 0 EG</p>
        <p id="final-price">Final Price: 0 EG</p>
    </div>

    <div class="checkout-buttons">
        <button onclick="confirmOrder()">Confirm Order</button>
    </div>

    <script>
        function loadCheckoutProducts() {
            const selectedProducts = JSON.parse(localStorage.getItem('selectedProducts')) || [];
            const checkoutProductsDiv = document.getElementById('checkout-products');

            checkoutProductsDiv.innerHTML = '';
            selectedProducts.forEach((product, index) => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product';
                productDiv.innerHTML = `
                    <img src="${product.img}" alt="${product.name}">
                    <div class="product-details">
                        <h3>${product.name}</h3>
                        <p>${product.discr}</p>
                        <p>Price: ${product.price} EG</p>
                        <p>Quantity: ${product.quantity}</p>
                        <div class="delivery-options">
                            <label><input type="radio" name="delivery-${index}" value="0" checked> One week (Free)</label><br>
                            <label><input type="radio" name="delivery-${index}" value="50"> Two days (50 EG)</label><br>
                            <label><input type="radio" name="delivery-${index}" value="100"> Same day (100 EG)</label>
                        </div>
                        <button onclick="removeProduct(${index})">Remove</button>
                    </div>
                `;
                checkoutProductsDiv.appendChild(productDiv);
            });

            updateTotalPrice();
        }

        function removeProduct(index) {
            let selectedProducts = JSON.parse(localStorage.getItem('selectedProducts')) || [];
            selectedProducts.splice(index, 1);
            localStorage.setItem('selectedProducts', JSON.stringify(selectedProducts));
            loadCheckoutProducts();
        }

        function updateTotalPrice() {
            const selectedProducts = JSON.parse(localStorage.getItem('selectedProducts')) || [];
            let totalPrice = selectedProducts.reduce((total, product) => total + (product.price * product.quantity), 0);
            let deliveryCost = Array.from(document.querySelectorAll('input[type="radio"]:checked')).reduce((total, radio) => total + parseInt(radio.value), 0);
            let tax = totalPrice * 0.14;
            let finalPrice = totalPrice + tax + deliveryCost;

            document.getElementById('total-price').textContent = 'Total Price:' + totalPrice + 'EG';
            document.getElementById('tax').textContent = 'Tax (14%):' + tax + 'EG';
            document.getElementById('final-price').textContent = 'Final Price:' + finalPrice  +'EG';
        }

        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', updateTotalPrice);
        });

        function confirmOrder() {
            const selectedProducts = JSON.parse(localStorage.getItem('selectedProducts')) || [];
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push(selectedProducts);
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.removeItem('selectedProducts');
            alert('Order confirmed!');
            window.location.href = 'home.html';
        }

        loadCheckoutProducts();
    </script>
</body>
</html>